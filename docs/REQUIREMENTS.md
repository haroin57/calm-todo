# ToDoリストアプリ 要件定義書

**Version:** 2.0
**Date:** 2026-01-08
**Status:** Draft

---

## 1. プロジェクト概要

### 1.1 プロダクトビジョン

「静かに背中を押す」タスク管理アプリ。機能美と低認知負荷を両立し、ユーザーの生産性と達成感を自然に高める。**完全オフライン対応**で、アカウント登録不要。

### 1.2 ターゲットユーザー

- 個人でタスク管理を行うナレッジワーカー
- シンプルで美しいツールを好むユーザー
- プライバシーを重視し、データをローカルに保持したいユーザー
- アカウント登録なしですぐに使い始めたいユーザー

### 1.3 プラットフォーム

| プラットフォーム | 対応 | 備考 |
|------------------|------|------|
| Windows Desktop | ✓ | Tauriによるネイティブアプリ |
| Web Browser | ✓ | ローカルサーバーで実行 |
| macOS | - | 将来対応予定 |
| Linux | - | 将来対応予定 |

---

## 2. 技術スタック

### 2.1 フロントエンド

| 技術 | 用途 |
|------|------|
| React 18+ | UIフレームワーク |
| TypeScript | 型安全な開発 |
| Tauri 2.x | デスクトップアプリラッパー |
| Vite | ビルドツール |
| LocalStorage | ブラウザデータ永続化 |

### 2.2 データ永続化

| 技術 | 用途 |
|------|------|
| LocalStorage | ブラウザ内データ保存 |
| ファイルバックアップ | Cドライブへの自動バックアップ |
| JSON形式 | データエクスポート/インポート |

### 2.3 外部API（オプション）

| サービス | 用途 |
|----------|------|
| OpenAI API (GPT-4o-mini) | タスク分割提案（APIキー任意設定） |

### 2.4 アーキテクチャ図

```
┌─────────────────────────────────────────────────────────────────┐
│                        Client Layer                             │
│  ┌─────────────────────────┐  ┌─────────────────────────────┐  │
│  │   Tauri (Windows)       │  │   Web Browser               │  │
│  │   ┌─────────────────┐   │  │   ┌─────────────────────┐   │  │
│  │   │  React App      │   │  │   │  React App          │   │  │
│  │   │  (Shared Code)  │   │  │   │  (Shared Code)      │   │  │
│  │   └─────────────────┘   │  │   └─────────────────────┘   │  │
│  │   + Native Features     │  │                             │  │
│  │     - Notifications     │  │                             │  │
│  │     - File Backup       │  │                             │  │
│  └─────────────────────────┘  └─────────────────────────────┘  │
└───────────────────────────────────────────────────────────────────┘
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│                       Local Storage Layer                       │
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐   │
│  │ LocalStorage    │ │ File Backup     │ │ IndexedDB       │   │
│  │ (Primary)       │ │ (C:/Backup)     │ │ (Future)        │   │
│  └─────────────────┘ └─────────────────┘ └─────────────────┘   │
└───────────────────────────────────────────────────────────────────┘
                            │
                            ▼ (オプション)
┌─────────────────────────────────────────────────────────────────┐
│                      External Services                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ OpenAI API (GPT-4o-mini) - Task Decomposition           │   │
│  │ ※ユーザーがAPIキーを設定した場合のみ                    │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 3. 機能要件

### 3.1 アプリ起動

#### FR-LAUNCH-001: 即時利用開始

| 項目 | 内容 |
|------|------|
| 概要 | アカウント登録・ログイン不要で即座に利用開始 |
| 初回起動 | 空のタスクリストを表示 |
| データ復元 | LocalStorageまたはバックアップから自動復元 |

### 3.2 タスク管理

#### FR-TASK-001: タスクの作成

| フィールド | 型 | 必須 | デフォルト値 | 説明 |
|------------|-----|------|--------------|------|
| id | string | - | 自動生成 | UUID v4 |
| text | string | ✓ | - | タスク名（最大200文字） |
| completed | boolean | - | false | 完了状態 |
| createdAt | number | - | 自動 | 作成日時（タイムスタンプ） |
| priority | enum | - | "medium" | "high" / "medium" / "low" |
| group | string | - | "default" | 所属グループ |
| parentId | string | - | null | 親タスクID（サブタスクの場合） |
| reminder | number | - | null | リマインダー日時（タイムスタンプ） |
| reminderSent | boolean | - | false | リマインダー送信済みか |
| weeklyReminder | object | - | null | 週次リマインダー設定 |

#### FR-TASK-002: タスクの編集

- すべてのフィールドを編集可能
- インライン編集対応（ダブルクリックで即編集）
- 優先度はクリックでサイクル変更

#### FR-TASK-003: タスクの削除

- 単一タスク削除
- 親タスク削除時、サブタスクも連動削除

#### FR-TASK-004: タスクの完了

- チェックボックスクリックで完了トグル
- 親タスク完了時、子タスクも一括完了

#### FR-TASK-005: サブタスク

- 任意のタスクに子タスクを追加可能
- 最大ネスト深度: 4階層
- 深度に応じたインデント表示
- 折りたたみ/展開機能

### 3.3 グループ管理

#### FR-GROUP-001: グループのCRUD

| フィールド | 型 | 必須 | 説明 |
|------------|-----|------|------|
| name | string | ✓ | グループ名（最大50文字） |

#### FR-GROUP-002: デフォルトグループ

- "default": 未分類タスクの受け皿（削除不可）

#### FR-GROUP-003: タブ表示

- グループをタブとして表示
- タブ切り替えでグループ内タスクをフィルター

### 3.4 検索・フィルター

#### FR-FILTER-001: ステータスフィルター

| フィルター | オプション |
|------------|------------|
| ステータス | すべて / 未完了 / 完了 |

### 3.5 リマインダー

#### FR-REMIND-001: 1回限りのリマインダー

| 項目 | 内容 |
|------|------|
| 日時指定 | datetime-localで日時選択 |
| 通知 | Web Notifications APIで通知 |
| 自動チェック | 1分ごとに期限チェック |

#### FR-REMIND-002: 週次リマインダー

| 項目 | 内容 |
|------|------|
| 曜日指定 | 日〜土の複数選択可能 |
| 時刻指定 | 通知時刻を設定 |
| 繰り返し | 毎週指定曜日に通知 |

### 3.6 データバックアップ

#### FR-BACKUP-001: 自動バックアップ

| 項目 | 内容 |
|------|------|
| 保存先 | C:/CalmTodoBackup/calm-todo-backup.json |
| タイミング | タスク変更時に自動保存 |
| 形式 | JSON |

#### FR-BACKUP-002: バックアップからの復元

- 設定画面から手動復元
- LocalStorageが空の場合、自動復元

#### FR-BACKUP-003: エクスポート/インポート

```json
{
  "todos": [...],
  "collapsed": [...],
  "savedAt": "2026-01-08T12:00:00Z"
}
```

### 3.7 通知

#### FR-NOTIF-001: デスクトップ通知

| 通知タイプ | タイミング |
|------------|------------|
| 1回リマインダー | 指定日時 |
| 週次リマインダー | 指定曜日・時刻 |

#### FR-NOTIF-002: 通知許可

- アプリ起動時に通知許可をリクエスト

### 3.8 AIタスク分割（オプション）

#### FR-AI-001: APIキー設定

| 項目 | 内容 |
|------|------|
| 保存先 | LocalStorage |
| 形式 | OpenAI APIキー（sk-...） |

#### FR-AI-002: 分割提案生成

| 項目 | 仕様 |
|------|------|
| 使用モデル | GPT-4o-mini |
| 生成数 | 3〜7サブタスク |
| 出力形式 | JSON（タイトル、優先度） |
| 言語 | 日本語 |

#### FR-AI-003: 提案の適用

- 個別サブタスクの選択/除外
- タイトルの編集
- 優先度の変更
- 一括適用でサブタスク作成

---

## 4. 非機能要件

### 4.1 パフォーマンス

| 項目 | 目標値 |
|------|--------|
| 初期ロード時間 | 2秒以内 |
| タスク操作レスポンス | 100ms以内 |
| アニメーションFPS | 60fps維持 |

### 4.2 データ保護

| 項目 | 対策 |
|------|------|
| データ保存 | ローカルのみ（外部送信なし） |
| バックアップ | ローカルファイルに自動保存 |
| APIキー | LocalStorageに保存（ユーザー責任） |

### 4.3 可用性

| 項目 | 目標 |
|------|------|
| オフライン動作 | 100%（全機能） |
| データ永続性 | LocalStorage + ファイルバックアップ |

### 4.4 スケーラビリティ

| 項目 | 上限 |
|------|------|
| タスク数 | 10,000件（LocalStorage制限内） |
| グループ数 | 100件 |
| サブタスクネスト | 4階層 |

### 4.5 アクセシビリティ

| 項目 | 対応 |
|------|------|
| キーボード操作 | 主要機能対応 |
| コントラスト比 | WCAG AA準拠（4.5:1以上） |
| フォーカス表示 | 明確なフォーカスインジケーター |

---

## 5. UI/UX設計

### 5.1 デザインコンセプト

**"Calm Industrial" — 静謐な工業美学**

機能が美を生むインターフェース。装飾ではなく、情報の階層と余白が美しさを作る。

### 5.2 デザイントークン

#### Typography

```css
:root {
  --font-display: 'Darker Grotesque', sans-serif;
  --font-body: 'IBM Plex Sans JP', 'IBM Plex Sans', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
}
```

#### Color System

```css
:root {
  /* Base */
  --void: #0a0a0b;
  --surface-1: #111113;
  --surface-2: #18181b;
  --surface-3: #27272a;

  /* Text */
  --text-primary: #fafafa;
  --text-secondary: #a1a1aa;
  --text-tertiary: #52525b;

  /* Accent */
  --amber-glow: #f59e0b;
  --amber-dim: #b45309;
  --amber-ghost: rgba(245, 158, 11, 0.08);

  /* Semantic */
  --priority-high: #ef4444;
  --priority-mid: #f59e0b;
  --priority-low: #3b82f6;
  --success: #10b981;

  /* Effects */
  --border-subtle: rgba(255, 255, 255, 0.06);
}
```

### 5.3 画面構成

```
┌─────────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                     Header                                  ││
│  │  Calm Todo                              ⚙ 設定              ││
│  └─────────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  [入力欄]                                        [追加]     ││
│  └─────────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  [デフォルト] [グループA] [グループB] [+ グループ]          ││
│  └─────────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  [すべて] [未完了] [完了]                                   ││
│  └─────────────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────────────┐│
│  │  □ 中 タスク1                          ✎ 🔔 ✨ ×          ││
│  │    □ 中 サブタスク1-1                  ✎ 🔔 ✨ ×          ││
│  │    □ 中 サブタスク1-2                  ✎ 🔔 ✨ ×          ││
│  │  □ 高 タスク2                          ✎ 🔔 ✨ ×          ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

### 5.4 主要コンポーネント

#### Task Item

```
┌─────────────────────────────────────────────────────────────────┐
│ ▼ □ 中 タスクタイトル                         ✎ 🔔 ✨ ×       │
└─────────────────────────────────────────────────────────────────┘
  ↑ 折りたたみボタン（子タスクがある場合）
```

#### Child Task Item

```
    ┌─────────────────────────────────────────────────────────┐
    │ □ 低 サブタスクタイトル               ✎ 🔔 ✨ ×       │
    └─────────────────────────────────────────────────────────┘
    ↑ インデント（深度に応じて増加）
```

---

## 6. データモデル

### 6.1 LocalStorage構造

```typescript
// calm-todo-items
interface Todo {
  id: string
  text: string
  completed: boolean
  createdAt: number
  parentId: string | null
  priority: "high" | "medium" | "low"
  group: string
  reminder: number | null
  reminderSent: boolean
  weeklyReminder: {
    days: number[]      // 0=日, 1=月, 2=火, 3=水, 4=木, 5=金, 6=土
    time: string        // "HH:MM"
    lastSent: string | null  // "YYYY-MM-DD"
  } | null
}

// calm-todo-collapsed
type CollapsedIds = string[]

// calm-todo-api-key
type ApiKey = string
```

### 6.2 バックアップファイル構造

```json
{
  "todos": [
    {
      "id": "uuid",
      "text": "タスク名",
      "completed": false,
      "createdAt": 1704700800000,
      "parentId": null,
      "priority": "medium",
      "group": "default",
      "reminder": null,
      "reminderSent": false,
      "weeklyReminder": null
    }
  ],
  "collapsed": ["uuid1", "uuid2"],
  "savedAt": "2026-01-08T12:00:00.000Z"
}
```

---

## 7. API仕様

### 7.1 OpenAI API (タスク分割) - オプション

#### Request

```typescript
POST https://api.openai.com/v1/chat/completions

{
  "model": "gpt-4o-mini",
  "temperature": 0.3,
  "max_tokens": 1024,
  "response_format": { "type": "json_object" },
  "messages": [
    { "role": "system", "content": "<System Prompt>" },
    { "role": "user", "content": "<User Prompt>" }
  ]
}
```

#### Response

```json
{
  "subtasks": [
    {
      "title": "サブタスク名",
      "priority": "medium"
    }
  ]
}
```

---

## 8. エラーハンドリング

### 8.1 エラーメッセージ方針

| NG | OK |
|-----|-----|
| Oops! Something went wrong | 保存できませんでした |
| Error 500 | 接続エラー |
| Invalid input | タイトルを入力してください |

### 8.2 リトライ戦略

| エラー種別 | 対応 |
|------------|------|
| LocalStorage容量超過 | 古いデータの削除を提案 |
| バックアップ失敗 | コンソールに警告、動作継続 |
| API制限エラー | 待ち時間を表示 |

---

## 9. テスト要件

### 9.1 テスト種別

| 種別 | カバレッジ目標 | ツール |
|------|----------------|--------|
| ユニットテスト | 80%以上 | Vitest |
| 統合テスト | 主要フロー100% | Vitest + Testing Library |

### 9.2 テストケース（主要）

#### タスク管理

- [ ] タスク作成
- [ ] タスク編集
- [ ] タスク削除
- [ ] タスク完了/未完了トグル
- [ ] 親タスク完了時の子タスク一括完了
- [ ] サブタスク作成

#### データ永続化

- [ ] LocalStorage保存
- [ ] LocalStorage読み込み
- [ ] バックアップ保存
- [ ] バックアップからの復元

#### リマインダー

- [ ] 1回リマインダー設定
- [ ] 週次リマインダー設定
- [ ] 通知発火

#### AI分割（APIキー設定時）

- [ ] 分割提案生成
- [ ] 提案の適用

---

## 10. 開発フェーズ

### Phase 1: 基盤構築 ✓

- プロジェクト初期設定（Tauri + React + TypeScript）
- 基本UI実装（レイアウト、デザイントークン）
- LocalStorage永続化

### Phase 2: コア機能 ✓

- タスクCRUD
- グループ管理
- サブタスク（ネスト構造）
- 折りたたみ機能

### Phase 3: 拡張機能 ✓

- リマインダー（1回/週次）
- ファイルバックアップ
- デスクトップ通知

### Phase 4: AI・UX強化 ✓

- AIタスク分割機能（オプション）
- サブタスク編集機能

### Phase 5: 品質・リリース

- テスト実装
- パフォーマンス最適化
- インストーラー作成
- リリース

---

## 11. 用語集

| 用語 | 定義 |
|------|------|
| タスク | 実行すべき作業項目 |
| サブタスク | 親タスクに紐づく子タスク |
| グループ | タスクをグループ化するカテゴリ（タブ表示） |
| デフォルト | 未分類タスクのデフォルト受け皿 |
| リマインダー | 指定日時に通知する機能 |
| 週次リマインダー | 毎週指定曜日に通知する機能 |
| タスク分割 | AIによるサブタスク提案機能 |

---

## 12. 改訂履歴

| バージョン | 日付 | 変更内容 |
|------------|------|----------|
| 1.0 | 2026-01-08 | 初版作成 |
| 2.0 | 2026-01-08 | ローカル完結型に変更（Firebase削除） |
